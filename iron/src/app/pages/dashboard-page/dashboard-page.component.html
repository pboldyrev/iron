<app-confirmation-popup
  [title]="TEXTS.LOGOUT_TITLE"
  [subtitle]="TEXTS.LOGOUT_SUBTITLE"
  [confirmText]="TEXTS.LOGOUT_CTA"
  size="m"
  (confirmed)="onConfirmLogOut()"
  #logOutConfirmPopup
></app-confirmation-popup>
<app-add-asset-popup
    #addAssetPopup
></app-add-asset-popup>
<div class="dashboard-loader-full-page" *ngIf="(isNetworthLoading$ | async) && (isAssetsLoading$ | async)">
    <app-loading-state
        class="dashboard-loader-wrapper"
    ></app-loading-state>
</div>
<div 
    class="row dashboard-wrapper m-0" 
    [hidden]="(isNetworthLoading$ | async) && (isAssetsLoading$ | async)"
>
    <div class="col-lg-5 col-12 p-0">
        <div class="dashboard-side-wrapper">
            <app-loading-state
                *ngIf="(isNetworthLoading$ | async)"
                class="dashboard-loader-wrapper"
            ></app-loading-state>
            <div 
                class="p-4 p-md-5"
                [hidden]="(isNetworthLoading$ | async)"
            >
                <app-networth
                    [totalNetworth]="totalNetworth"
                ></app-networth>
                <app-value-change
                    [timeframes]="networthTimeframes"
                ></app-value-change>
            </div>
            <div 
                class="dashboard-networth-chart-wrapper px-3 pb-2"
                [hidden]="(isNetworthLoading$ | async)"
            >
                <canvas id="dashboardChart">{{ dashboardChart }}</canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-7 col-12 px-2 px-sm-3 px-md-5 py-4 dashboard-content-wrapper">
        <div class="row">
            <div class="col-12 dashboard-actions-wrapper pb-4">
                <blu-button 
                    type="primary" 
                    iconName="plus" 
                    (click)="onAddAsset()" 
                    [tooltip]="TEXTS.TOOLTIP_CTA"
                >
                    {{ TEXTS.BTN_PRIMARY_CTA }}
                </blu-button>
                <blu-button 
                    type="secondary" 
                    [iconOnly]="true" 
                    iconName="gear" 
                    (click)="onSettings()" 
                    [tooltip]="TEXTS.TOOLTIP_SETTINGS"
                ></blu-button>
                <blu-button 
                    type="secondary" 
                    [iconOnly]="true" 
                    iconName="signOut" 
                    (click)="onLogOut()" 
                    [tooltip]="TEXTS.TOOLTIP_LOG_OUT"
                ></blu-button>
                <blu-button 
                    type="info" 
                    [iconOnly]="true" 
                    iconName="help" 
                    (click)="onFeedback()" 
                    [tooltip]="TEXTS.TOOLTIP_FEEDBACK"
                ></blu-button>
            </div>
        </div>
        <app-error-state *ngIf="loadingFailed; else mainContent"></app-error-state>
        <ng-template #mainContent>
            <div class="row g-2 g-sm-3">
                <div class="col-12" [hidden]="(isAssetsLoading$ | async)">
                    <app-asset-table
                        [columns]="assetTableColumns"
                        [assets$]="assets$"
                        [loadingIndicator$]="isAssetsLoading$"
                        #assetTable
                    ></app-asset-table>
                </div>
                <div class="col-12" *ngIf="((assets$ | async) ?? []).length > 0 && showAnalytics" [hidden]="(isAssetsLoading$ | async)">
                    <app-ai-feedback
                        [assets$]="assets$"
                    ></app-ai-feedback>
                </div>
                <div *ngIf="((assets$ | async) ?? []).length > 0 && showAnalytics" [hidden]="(isAssetsLoading$ | async)">
                    <app-account-summary
                        [assets$]="assets$"
                    ></app-account-summary>
                </div>
                <div class="col-12" *ngIf="(isAssetsLoading$ | async)">
                    <app-loading-state
                        class="dashboard-loader-wrapper"
                    ></app-loading-state>
                </div>
                <div class="col-12 d-flex justify-content-center w-100" *ngIf="((assets$ | async) ?? []).length > 0 && !(isAssetsLoading$ | async)">
                    <blu-button type="secondary" [iconName]="showAnalytics ? 'collapse' : 'show'" (click)="onToggleAnalytics()">
                        <span *ngIf="!showAnalytics">{{ TEXTS.SHOW_CTA }}</span>
                        <span *ngIf="showAnalytics">{{ TEXTS.HIDE_CTA }}</span>
                        <span class="ps-1">{{ TEXTS.SHOW_CTA_END }}</span>
                    </blu-button>
                </div>
            </div>
        </ng-template>
    </div>
</div>